<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathHelper: Algebra-Spelen</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');

        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --danger: #e74c3c;
            --wood: #8d6e63;
            --wood-dark: #5d4037;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
        }

        /* --- MENY --- */
        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .menu-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            border: 4px solid transparent;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .menu-card.kiosk { border-color: var(--success); }
        .menu-card.wood { border-color: var(--wood); }

        .icon { font-size: 4rem; display: block; margin-bottom: 10px; }
        .title { font-size: 1.5rem; font-weight: 600; }

        /* --- GAME SCREENS --- */
        .game-screen {
            display: none; /* Hidden by default */
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            position: relative;
        }

        .active { display: block; }

        .back-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #eee;
            border: none;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        /* --- KIOSKEN (Styles) --- */
        .price-tag {
            background: #fff9c4;
            border: 2px solid #fbc02d;
            padding: 5px 10px;
            border-radius: 8px;
            display: inline-block;
            margin: 5px;
            font-weight: bold;
        }

        /* --- SNICKARBOA (Styles) --- */
        .wood-plank {
            background-color: var(--wood);
            height: 60px;
            width: 80%;
            margin: 20px auto;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            position: relative;
            box-shadow: 3px 3px 0 var(--wood-dark);
        }
        
        .measure-line {
            border-bottom: 2px dashed #333;
            width: 100%;
            position: relative;
            top: -10px;
            text-align: center;
        }

        /* --- INPUT --- */
        .input-area {
            margin-top: 30px;
            text-align: center;
        }

        input[type="text"] {
            font-size: 1.5rem;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #ccc;
            width: 70%;
            text-align: center;
            font-family: monospace;
        }

        button.action-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }

        .feedback {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            min-height: 1.5em;
            text-align: center;
        }
        .correct { color: var(--success); }
        .wrong { color: var(--danger); }
        .hint { color: #f39c12; font-size: 1rem; display: block; margin-top: 5px;}

    </style>
</head>
<body>

<div class="app-container">
    
    <!-- MAIN MENU -->
    <div id="menu" class="active">
        <h1 style="text-align: center; margin-bottom: 40px;">V√§lj Station üõ†Ô∏è</h1>
        <div class="menu-grid">
            <div class="menu-card kiosk" onclick="startGame('kiosk')">
                <span class="icon">üè™</span>
                <span class="title">Kiosken</span>
                <p>Pris, Antal & V√§xel</p>
            </div>
            <div class="menu-card wood" onclick="startGame('wood')">
                <span class="icon">üìè</span>
                <span class="title">Snickarboa</span>
                <p>L√§ngd & Str√§ckor</p>
            </div>
        </div>
    </div>

    <!-- KIOSK GAME -->
    <div id="game-kiosk" class="game-screen">
        <button class="back-btn" onclick="showMenu()">‚¨Ö Meny</button>
        <h2 style="text-align: center;">Kiosken</h2>
        
        <div id="kiosk-prices" style="text-align: center; margin-bottom: 20px;"></div>
        
        <div id="kiosk-question" style="font-size: 1.3rem; text-align: center; background: #e3f2fd; padding: 15px; border-radius: 10px;">
            Laddar...
        </div>

        <div class="input-area">
            <input type="text" id="kiosk-input" placeholder="Svar..." autocomplete="off">
            <button class="action-btn" onclick="checkKiosk()">Svara</button>
        </div>
        <div id="kiosk-feedback" class="feedback"></div>
    </div>

    <!-- WOOD GAME -->
    <div id="game-wood" class="game-screen">
        <button class="back-btn" onclick="showMenu()">‚¨Ö Meny</button>
        <h2 style="text-align: center;">Snickarboa</h2>

        <div style="text-align: center; margin-bottom: 20px;">
            <div class="wood-plank" id="wood-visual">x cm</div>
        </div>

        <div id="wood-question" style="font-size: 1.3rem; text-align: center; background: #fff3e0; padding: 15px; border-radius: 10px;">
            Laddar...
        </div>

        <div class="input-area">
            <input type="text" id="wood-input" placeholder="Svar..." autocomplete="off">
            <button class="action-btn" style="background-color: var(--wood);" onclick="checkWood()">S√•ga!</button>
        </div>
        <div id="wood-feedback" class="feedback"></div>
    </div>

</div>

<script>
    // --- STATE ---
    let currentMode = null;
    let currentQ = null;

    // --- DATA ---
    const fruits = [
        { name: "banan", price: 3, var: "x", icon: "üçå" },
        { name: "√§pple", price: 4, var: "y", icon: "üçé" },
        { name: "p√§ron", price: 5, var: "z", icon: "üçê" },
        { name: "kivi", price: 6, var: "a", icon: "ü•ù" }
    ];

    // --- NAVIGATION ---
    function showMenu() {
        document.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
        document.getElementById('menu').classList.add('active');
        currentMode = null;
    }

    function startGame(mode) {
        document.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
        document.getElementById(`game-${mode}`).classList.add('active');
        currentMode = mode;
        
        if (mode === 'kiosk') initKiosk();
        if (mode === 'wood') initWood();
    }

    // --- KIOSK LOGIC ---
    function initKiosk() {
        // Show prices
        const container = document.getElementById('kiosk-prices');
        container.innerHTML = fruits.map(f => 
            `<div class="price-tag">${f.icon} ${f.price} kr</div>`
        ).join('');
        nextKioskQ();
    }

    function nextKioskQ() {
        document.getElementById('kiosk-input').value = "";
        document.getElementById('kiosk-feedback').innerHTML = "";
        document.getElementById('kiosk-input').focus();

        const type = Math.floor(Math.random() * 3);
        const f1 = fruits[Math.floor(Math.random() * fruits.length)];
        
        if (type === 0) { // Pris
            currentQ = {
                text: `Vad f√•r du betala f√∂r <b>${f1.var}</b> st ${f1.name}er?`,
                answers: [`${f1.price}${f1.var}`, `${f1.price}*${f1.var}`]
            };
        } else if (type === 1) { // V√§xel 100
            currentQ = {
                text: `Du betalar med 100 kr f√∂r <b>${f1.var}</b> st ${f1.name}er. Vad f√•r du tillbaka?`,
                answers: [`100-${f1.price}${f1.var}`, `100-${f1.price}*${f1.var}`]
            };
        } else { // Tv√• varor
            const f2 = fruits.find(f => f !== f1);
            currentQ = {
                text: `Vad kostar <b>${f1.var}</b> st ${f1.name}er och <b>${f2.var}</b> st ${f2.name}er?`,
                answers: [
                    `${f1.price}${f1.var}+${f2.price}${f2.var}`,
                    `${f2.price}${f2.var}+${f1.price}${f1.var}`
                ]
            };
        }
        document.getElementById('kiosk-question').innerHTML = currentQ.text;
    }

    function checkKiosk() {
        validateAnswer(document.getElementById('kiosk-input').value, currentQ.answers, 'kiosk-feedback', nextKioskQ);
    }

    // --- WOOD LOGIC ---
    function initWood() {
        nextWoodQ();
    }

    function nextWoodQ() {
        document.getElementById('wood-input').value = "";
        document.getElementById('wood-feedback').innerHTML = "";
        document.getElementById('wood-input').focus();

        const type = Math.floor(Math.random() * 4);
        const val = Math.floor(Math.random() * 10) + 2; // 2-12
        
        if (type === 0) { // Kortare
            currentQ = {
                text: `Den h√§r br√§dan √§r <b>x</b> cm. <br>Vi beh√∂ver en som √§r <b>${val} cm kortare</b>.`,
                answers: [`x-${val}`]
            };
        } else if (type === 1) { // L√§ngre
            currentQ = {
                text: `Den h√§r br√§dan √§r <b>x</b> cm. <br>Vi beh√∂ver en som √§r <b>${val} cm l√§ngre</b>.`,
                answers: [`x+${val}`, `${val}+x`]
            };
        } else if (type === 2) { // Dubbelt
            currentQ = {
                text: `Den h√§r br√§dan √§r <b>x</b> cm. <br>Vi beh√∂ver en som √§r <b>dubbelt</b> s√• l√•ng.`,
                answers: [`2x`, `2*x`, `x*2`]
            };
        } else { // H√§lften
            currentQ = {
                text: `Den h√§r br√§dan √§r <b>x</b> cm. <br>Vi beh√∂ver en som √§r <b>h√§lften</b> s√• l√•ng.`,
                answers: [`x/2`, `0.5x`, `0.5*x`, `x*0.5`]
            };
        }
        document.getElementById('wood-question').innerHTML = currentQ.text;
    }

    function checkWood() {
        validateAnswer(document.getElementById('wood-input').value, currentQ.answers, 'wood-feedback', nextWoodQ);
    }

    // --- SMART VALIDATION ---
    function smartNormalize(str) {
        let s = str.toLowerCase();
        s = s.replace(/\s/g, ''); // Ta bort mellanslag
        s = s.replace(',', '.');   // Komma till punkt
        s = s.replace(/\*/g, '');  // Ta bort g√•nger (3*x -> 3x)
        
        // Smart fix: "y4" -> "4y" (Bokstav f√∂ljt av Siffra -> Byt plats)
        // Regex f√•ngar: (en bokstav a-z)(ett eller flera nummer)
        s = s.replace(/([a-z√•√§√∂])([0-9]+)/g, '$2$1');
        
        return s;
    }

    function validateAnswer(input, answers, feedbackId, nextFn) {
        const cleanInput = smartNormalize(input);
        const cleanAnswers = answers.map(a => smartNormalize(a));

        const el = document.getElementById(feedbackId);
        
        // Kolla om input finns i facit
        if (cleanAnswers.includes(cleanInput)) {
            el.innerHTML = "<span class='correct'>‚úÖ R√§tt!</span>";
            
            // Pedagogisk feedback om man skrev y4 men vi godk√§nde det
            if (input.match(/[a-z][0-9]/i)) {
               el.innerHTML += "<span class='hint'>Tips: I matten skriver man oftast siffran f√∂rst (4y ist√§llet f√∂r y4).</span>";
            }

            setTimeout(nextFn, 2000); // Lite l√§ngre tid f√∂r att hinna l√§sa tipset
        } else {
            el.innerHTML = "<span class='wrong'>‚ùå Inte riktigt. F√∂rs√∂k igen!</span>";
        }
    }

    // Enter Key Support
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            if (currentMode === 'kiosk') checkKiosk();
            if (currentMode === 'wood') checkWood();
        }
    });

</script>

<!-- MathHelper v2.2: Smarter Validation -->
</body>
</html>
